<p id="notice"><%= notice %></p>

<h1>Users</h1>

<table>
  <thead>
    <tr>
      <th>Username</th>
      <th>Grade</th>
      <th>Password digest</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
      <tr>
        <td><%= user.username %></td>
        <td>
          <% totalsemesters =0%>
          <% semestergpa =0%>
          <% user.semesters.each do |semester|%>
            <% totalcredithours =0%>
            <% totalgradepointstimescredithours = 0%>
                <% semester.courses.each do |course|%>
                  <% totalcredithours = totalcredithours + course.credits%>
                  <% if course.grade == "A"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*4.00%>
                  <% elsif course.grade == "A-"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*3.70%>
                  <% elsif course.grade == "B+"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*3.33%>
                  <% elsif course.grade == "B"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*3.00%>
                  <% elsif course.grade == "B-"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*2.70%>
                  <% elsif course.grade == "C+"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*2.30%>
                  <% elsif course.grade == "C"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*2.00%>
                  <% elsif course.grade == "C-"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*1.70%>
                  <% elsif course.grade == "D+"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*1.30%>
                  <% elsif course.grade == "D"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*1.00%>
                  <% elsif course.grade == "D-"%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*0.70%>
                  <% else%>
                    <% totalgradepointstimescredithours = totalgradepointstimescredithours + course.credits*0%>
                  <% end %>
                  <% end %>
                  <% if totalcredithours == 0 %>
                    <% semestergpatemp = 0 %>
                  <% else %>
                    <% semestergpatemp = totalgradepointstimescredithours/totalcredithours %>
                  <% end %>
              <% semestergpa = semestergpa + semestergpatemp%>
              <% totalsemesters = totalsemesters + 1%>
          <% end %>
          <%= semestergpa/totalsemesters%>
        </td>
        <td><%= user.password_digest %></td>
        <td><%= link_to 'Show', user %></td>
        <td><%= link_to 'Edit', edit_user_path(user) %></td>
        <td><%= link_to 'Destroy', user, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
      <tr>
        <td><p> Total credits </p> <%= user.num_credits %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<%= link_to 'New User', new_user_path %>
